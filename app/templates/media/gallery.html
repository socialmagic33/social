{% extends "base.html" %}

{% block title %}Media Gallery - LeadMagic{% endblock %}

{% block content %}
<div data-fade-in>
    <div class="card mb-6">
        <div class="card-header">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="card-title">Media Gallery</h1>
                    <p class="card-description">Manage your uploaded photos and videos</p>
                </div>
                <a href="/upload" class="btn btn-primary">Upload Media</a>
            </div>
        </div>
    </div>

    <!-- Filter Buttons -->
    <div class="card mb-6">
        <div class="flex gap-2">
            <button onclick="filterMedia('all')" class="btn btn-outline filter-btn active">All</button>
            <button onclick="filterMedia('before')" class="btn btn-outline filter-btn">Before</button>
            <button onclick="filterMedia('in_progress')" class="btn btn-outline filter-btn">In Progress</button>
            <button onclick="filterMedia('after')" class="btn btn-outline filter-btn">After</button>
        </div>
    </div>

    <!-- Media Grid -->
    {% if media_items %}
    <div class="grid grid-cols-4 gap-6" id="media-grid">
        {% for media in media_items %}
        <div class="media-item card" data-status="{{ media.status.value }}">
            <div class="media-container" style="aspect-ratio: 16/9; position: relative;">
                {% if media.file_url.endswith(('.mp4', '.mov', '.webm')) %}
                <video src="{{ media.file_url }}" class="w-full h-full object-cover rounded" controls></video>
                {% else %}
                <img src="{{ media.file_url }}" alt="{{ media.description }}" class="w-full h-full object-cover rounded">
                {% endif %}
                
                <div class="media-overlay">
                    <div class="flex justify-between items-center">
                        <span class="badge badge-{{ 'success' if media.status.value == 'after' else 'warning' if media.status.value == 'in_progress' else 'info' }}">
                            {{ media.status.value.replace('_', ' ').title() }}
                        </span>
                        <div class="flex">
                            {% for i in range(media.star_rating) %}
                            <span style="color: #fbbf24;">â˜…</span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="padding: 1rem 0;">
                <p class="font-medium">{{ media.description or "No description" }}</p>
                {% if media.notes %}
                <p class="text-sm text-secondary mt-1">{{ media.notes }}</p>
                {% endif %}
                <p class="text-sm text-secondary mt-1">{{ media.jobsite.address if media.jobsite else "No jobsite" }}</p>
                <div class="flex justify-between items-center mt-2">
                    <span class="text-sm text-secondary">{{ media.created_at.strftime('%Y-%m-%d') }}</span>
                    <a href="/media/{{ media.id }}" class="btn btn-outline" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">View</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="card text-center">
        <div style="padding: 3rem;">
            <h3 class="text-xl font-semibold mb-4">No media uploaded yet</h3>
            <p class="text-secondary mb-6">Start by uploading photos and videos from your jobsites</p>
            <a href="/upload" class="btn btn-primary">Upload Your First Media</a>
        </div>
    </div>
    {% endif %}
</div>

<style>
.filter-btn.active {
    background-color: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}
</style>

<script>
function filterMedia(status) {
    const items = document.querySelectorAll('.media-item');
    const buttons = document.querySelectorAll('.filter-btn');
    
    // Update active button
    buttons.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    // Filter items
    items.forEach(item => {
        if (status === 'all' || item.dataset.status === status) {
            item.style.display = 'block';
        } else {
            item.style.display = 'none';
        }
    });
}
</script>
{% endblock %}